# 🍅 番茄工作法计时器

极简的番茄工作法计时器，专为 iPadOS 17+ 设计。

## ✨ 功能特性

### 核心功能
- **三段模式**：工作（25分钟）、短休息（5分钟）、长休息（15分钟）
- **精准计时**：采用目标结束时间 + 单调时钟策略，避免后台/休眠导致的计时漂移
- **智能切换**：每完成 4 个工作番茄自动进入长休息
- **灵活控制**：开始/暂停、重置、+5分钟、跳过

### 提醒系统
- **本地通知**：前台/后台均可收到完成提醒
- **蜂鸣音效**：可选系统声音提示
- **触觉反馈**：操作和完成时的震动反馈

### 电源管理
- **保持常亮**：计时时可选禁用自动锁屏
- **多窗口支持**：仅一个活动计时器，其他窗口只读跟随

### 数据统计
- **今日统计**：完成番茄数、总分钟数
- **周统计**：本周汇总数据
- **连续天数**：Streak 记录
- **CSV 导出**：一键导出历史数据

### 可访问性
- ✅ VoiceOver 支持
- ✅ Dynamic Type（动态字体）
- ✅ Reduce Motion（减弱动画）
- ✅ WCAG AA 对比度标准

### 键盘快捷键
- `空格` - 开始/暂停
- `R` - 重置
- `1/2/3` - 切换到工作/短休息/长休息
- `N` - 跳到下一段
- `↑/↓` - 当前模式时长 ±1 分钟

## 🎨 设计

- **主色**：#B52B2D（番茄红）
- **背景**：#F9F9F5（淡黄）
- **文字**：#2B2B2B（深灰）
- **风格**：极简、大量留白、无花哨动效

## 🛠️ 技术栈

- **平台**：iPadOS 17.0+
- **框架**：SwiftUI、Combine
- **功能**：UserNotifications、AVFoundation、UIKit (Haptics)
- **架构**：MVVM + Actor 并发
- **测试**：XCTest
- **CI/CD**：GitHub Actions

## 📦 构建与安装

### 前置要求

1. **GitHub 账号**（用于构建）
2. **Apple 开发者账号**（免费或付费，用于签名）
3. **签名工具**（选择一种）：
   - **Sideloadly**（推荐，最简单）
   - **AltStore**
   - **Xcode**（如有 Mac）

### 快速开始（3 步）

#### 步骤 1：GitHub 自动构建

1. 推送代码到 GitHub（或手动触发 Actions）
2. 等待 10-15 分钟自动构建
3. ✅ **无需配置任何 Apple 凭证！**

#### 步骤 2：下载未签名 IPA

1. 在 **Actions** 页面找到最新的成功构建
2. 滚动到底部 **Artifacts** 区域
3. 下载 **TomatoTimer-Unsigned-IPA**
4. 解压得到 `TomatoTimer-unsigned.ipa`

#### 步骤 3：自签名并安装

使用 **Sideloadly**（推荐）：

1. 下载 [Sideloadly](https://sideloadly.io/)（支持 Windows/Mac）
2. iPad 通过 USB 连接电脑
3. 将 `TomatoTimer-unsigned.ipa` 拖入 Sideloadly
4. 输入您的 Apple ID 和密码
5. 点击 **Start**，等待签名并自动安装
6. iPad 信任证书（设置 → 通用 → VPN 与设备管理）

**详细签名指南**：查看 [SELF_SIGNING_GUIDE.md](SELF_SIGNING_GUIDE.md)，包含多种签名方式。

### ⚠️ 免费账号限制

使用免费 Apple 开发者账号有以下限制：

1. **7 天有效期**：应用签名 7 天后过期，需重新签名
2. **设备限制**：每个 Apple ID 最多 3 台设备
3. **通知受限**：本地通知可能无法正常工作（需付费账号）

**自动刷新**：Sideloadly 和 AltStore 都支持自动刷新，保持电脑运行即可。

## 🧪 测试

运行单元测试：

```bash
xcodebuild test \
  -project TomatoTimer.xcodeproj \
  -scheme TomatoTimer \
  -destination 'platform=iOS Simulator,name=iPad Pro (12.9-inch) (6th generation)'
```

## 📝 使用说明

### 基本使用

1. **选择模式**：顶部分段控制器选择工作/短休息/长休息
2. **开始计时**：点击"开始"按钮或按空格键
3. **暂停**：点击"暂停"或再次按空格键
4. **重置**：点击"重置"按钮或按 `R` 键
5. **完成**：计时结束后会收到通知、声音和触觉反馈

### 高级功能

- **+5 分钟**：临时延长当前计时
- **跳过**：完成当前阶段并切换到下一个
- **自动切换**：在设置中开启后，完成时自动进入下一阶段
- **保持常亮**：计时时保持屏幕不锁定

### 查看统计

1. 切换到"历史"页面
2. 查看今日、本周的番茄数和时长
3. 查看连续天数（Streak）
4. 点击"导出"按钮导出 CSV 数据

### 自定义设置

1. 切换到"设置"页面
2. 调整各模式的时长（1-60 分钟）
3. 开关通知、声音、触觉、自动切换等功能

## 🐛 已知问题

- 免费开发者账号的本地通知可能受限
- 7 天签名有效期需要定期刷新

## 📄 许可证

MIT License

## 🙏 致谢

采用番茄工作法（Pomodoro Technique）提升工作效率。

---

**祝您高效工作！** 🍅

